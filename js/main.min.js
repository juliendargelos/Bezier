var graph={element:document.getElementsByTagName("main")[0],curve:new Bezier,controls:[],moving:null,get svg(){return this.curve.svg},get width(){return this.element.offsetWidth},get height(){return this.element.offsetHeight},set scale(t){t>1&&(t=1),this.svg.setAttribute("style","transform: scale("+t+");")},control:function(t,e){var i=this,n=(this.controls.length,this.curve.add(t,e));if(0!=n){var s={circle:document.createElementNS(this.svg.namespaceURI,"circle"),line:document.createElementNS(this.svg.namespaceURI,"line"),init:{x:0,y:0,relative:!1},offset:this.controls.length,point:n};s.circle.setAttribute("r",5),s.circle.addEventListener("mousedown",function(t){s.init={x:t.clientX-s.point.x,y:t.clientY-s.point.y},i.moving=s}),s.circle.addEventListener("dblclick",function(t){s.remove(),t.stopPropagation()}),s.update=function(){if(this.circle.setAttribute("cx",this.point.x),this.circle.setAttribute("cy",this.point.y),this.offset+1<i.controls.length){this.line.parentNode||i.svg.insertBefore(this.line,i.svg.firstChild);var t=i.controls[this.offset+1].point;this.line.setAttribute("x1",this.point.x),this.line.setAttribute("y1",this.point.y),this.line.setAttribute("x2",t.x),this.line.setAttribute("y2",t.y)}else this.line.parentNode&&this.line.parentNode.removeChild(this.line);this.offset>0&&i.controls[this.offset-1].update()},s.remove=function(){this.circle.parentNode&&this.circle.parentNode.removeChild(this.circle),this.line.parentNode&&this.line.parentNode.removeChild(this.line),i.controls=i.controls.slice(0,this.offset).concat(i.controls.slice(this.offset+1));for(var t=s.offset;t<i.controls.length;t++)i.controls[t].offset=t;i.curve.points=i.controls.map(function(t){return t.point});for(var t=0;t<i.curve.points.length;t++)i.controls[t].point=i.curve.points[t];i.update()},this.svg.appendChild(s.circle),this.controls.push(s),s.update()}},update:function(){for(var t=0;t<this.controls.length;t++)this.controls[t].update()},init:function(){var t=this;window.addEventListener("mousemove",function(e){if(null!==t.moving){var i=t.moving;i.point.x=e.clientX-i.init.x,i.point.y=e.clientY-i.init.y,i.update()}}),window.addEventListener("mouseup",function(){t.moving=null}),this.element.addEventListener("dblclick",function(e){t.control(e.clientX,e.clientY)}),this.control(this.width/2-100,this.height/2+100),this.control(this.width/2-100,this.height/2-50),this.control(this.width/2+100,this.height/2+50),this.control(this.width/2+100,this.height/2-100),this.update(),this.element.appendChild(this.svg)}};graph.init();